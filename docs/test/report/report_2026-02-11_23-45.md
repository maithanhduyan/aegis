# AegisOS Test Report

| Thuộc tính | Giá trị |
|---|---|
| **Ngày** | 2026-02-11 23:45 |
| **Hệ điều hành** | Windows |
| **Rust toolchain** | nightly-2026-02-09 (rustc 1.95.0-nightly 18d13b533) |
| **Commit** | 1ac823d |
| **Kết quả tổng** | ✅ ALL PASS |

---

## 1. Host Unit Tests

**Lệnh:** `cargo test --target x86_64-pc-windows-msvc --lib --test host_tests -- --test-threads=1`
**Kết quả:** 69 passed, 0 failed — ⏱ 0.04s

### Chi tiết

| # | Test | Nhóm | Kết quả |
|---|---|---|---|
| 1 | `trapframe_size_is_288` | TrapFrame | ✅ |
| 2 | `trapframe_alignment_is_16` | TrapFrame | ✅ |
| 3 | `trapframe_field_offsets` | TrapFrame | ✅ |
| 4 | `trapframe_zeroed_is_valid` | TrapFrame | ✅ |
| 5 | `mmu_valid_bit` | MMU Descriptors | ✅ |
| 6 | `mmu_table_vs_block_vs_page` | MMU Descriptors | ✅ |
| 7 | `mmu_attr_indices` | MMU Descriptors | ✅ |
| 8 | `mmu_access_permissions` | MMU Descriptors | ✅ |
| 9 | `mmu_shareability` | MMU Descriptors | ✅ |
| 10 | `mmu_access_flag` | MMU Descriptors | ✅ |
| 11 | `mmu_execute_never_bits` | MMU Descriptors | ✅ |
| 12 | `mmu_wxn_invariant` | MMU Descriptors | ✅ |
| 13 | `mmu_device_block_has_af` | MMU Descriptors | ✅ |
| 14 | `mmu_device_block_is_el1_only` | MMU Descriptors | ✅ |
| 15 | `mmu_device_block_is_non_executable` | MMU Descriptors | ✅ |
| 16 | `mmu_shared_code_page_is_executable` | MMU Descriptors | ✅ |
| 17 | `mmu_shared_code_page_is_readonly` | MMU Descriptors | ✅ |
| 18 | `mmu_user_code_page_el0_exec_only` | MMU Descriptors | ✅ |
| 19 | `mmu_user_data_page_is_el0_accessible` | MMU Descriptors | ✅ |
| 20 | `mmu_user_data_page_is_non_executable` | MMU Descriptors | ✅ |
| 21 | `mmu_kernel_data_page_is_el1_only` | MMU Descriptors | ✅ |
| 22 | `mmu_kernel_data_page_is_non_executable` | MMU Descriptors | ✅ |
| 23 | `validate_write_valid_ptr_in_ram` | SYS_WRITE Validation | ✅ |
| 24 | `validate_write_null_ptr` | SYS_WRITE Validation | ✅ |
| 25 | `validate_write_before_ram` | SYS_WRITE Validation | ✅ |
| 26 | `validate_write_past_ram_end` | SYS_WRITE Validation | ✅ |
| 27 | `validate_write_start_of_ram` | SYS_WRITE Validation | ✅ |
| 28 | `validate_write_end_of_ram` | SYS_WRITE Validation | ✅ |
| 29 | `validate_write_spans_boundary` | SYS_WRITE Validation | ✅ |
| 30 | `validate_write_zero_length` | SYS_WRITE Validation | ✅ |
| 31 | `validate_write_exactly_256` | SYS_WRITE Validation | ✅ |
| 32 | `validate_write_over_256` | SYS_WRITE Validation | ✅ |
| 33 | `validate_write_uart_mmio` | SYS_WRITE Validation | ✅ |
| 34 | `validate_write_wrapping_overflow` | SYS_WRITE Validation | ✅ |
| 35 | `sched_task_state_values` | Scheduler | ✅ |
| 36 | `sched_num_tasks` | Scheduler | ✅ |
| 37 | `sched_restart_delay` | Scheduler | ✅ |
| 38 | `sched_empty_tcb_is_zeroed` | Scheduler | ✅ |
| 39 | `sched_tcb_size` | Scheduler | ✅ |
| 40 | `sched_round_robin_all_ready` | Scheduler | ✅ |
| 41 | `sched_skip_faulted_task` | Scheduler | ✅ |
| 42 | `sched_skip_blocked_task` | Scheduler | ✅ |
| 43 | `sched_idle_fallback` | Scheduler | ✅ |
| 44 | `sched_auto_restart_after_delay` | Scheduler | ✅ |
| 45 | `sched_context_save_restore` | Scheduler | ✅ |
| 46 | `sched_save_load_frame` | Scheduler | ✅ |
| 47 | `sched_get_set_task_reg` | Scheduler | ✅ |
| 48 | `ipc_cleanup_clears_sender_slot` | IPC | ✅ |
| 49 | `ipc_cleanup_clears_receiver_slot` | IPC | ✅ |
| 50 | `ipc_cleanup_clears_both_endpoints` | IPC | ✅ |
| 51 | `ipc_cleanup_doesnt_affect_other_tasks` | IPC | ✅ |
| 52 | `ipc_copy_message` | IPC | ✅ |
| 53 | `ipc_msg_regs_count` | IPC | ✅ |
| 54 | `ipc_max_endpoints` | IPC | ✅ |
| 55 | `ipc_endpoint_initial_state` | IPC | ✅ |
| 56 | `cap_bits_are_distinct_powers_of_two` | Capability | ✅ |
| 57 | `cap_all_includes_every_bit` | Capability | ✅ |
| 58 | `cap_none_grants_nothing` | Capability | ✅ |
| 59 | `cap_check_single_bit` | Capability | ✅ |
| 60 | `cap_check_multi_bit_requirement` | Capability | ✅ |
| 61 | `cap_check_zero_required_always_passes` | Capability | ✅ |
| 62 | `cap_for_syscall_yield` | Capability | ✅ |
| 63 | `cap_for_syscall_send_recv` | Capability | ✅ |
| 64 | `cap_for_syscall_call_needs_both` | Capability | ✅ |
| 65 | `cap_for_syscall_write` | Capability | ✅ |
| 66 | `cap_for_syscall_invalid_returns_zero` | Capability | ✅ |
| 67 | `cap_name_returns_expected_strings` | Capability | ✅ |
| 68 | `cap_empty_tcb_has_zero_caps` | Capability | ✅ |
| 69 | `cap_survives_restart_simulation` | Capability | ✅ |

### Tóm tắt theo nhóm

| Nhóm | Pass | Fail | Tổng |
|---|---|---|---|
| TrapFrame Layout | 4 | 0 | 4 |
| MMU Descriptors | 18 | 0 | 18 |
| SYS_WRITE Validation | 12 | 0 | 12 |
| Scheduler | 13 | 0 | 13 |
| IPC | 8 | 0 | 8 |
| Capability | 14 | 0 | 14 |
| **Tổng** | **69** | **0** | **69** |

---

## 2. QEMU Boot Integration Test

**Lệnh:** `qemu-system-aarch64 -machine virt -cpu cortex-a53 -nographic -kernel target/aarch64-aegis/release/aegis_os`
**Timeout:** 10 giây
**Kết quả:** 9/9 checkpoints passed

### Checkpoints

| # | Checkpoint | Pattern | Kết quả |
|---|---|---|---|
| 1 | Kernel boot | `[AegisOS] boot` | ✅ |
| 2 | MMU enabled | `[AegisOS] MMU enabled` | ✅ |
| 3 | W^X enforced | `[AegisOS] W^X enforced` | ✅ |
| 4 | Exceptions ready | `[AegisOS] exceptions ready` | ✅ |
| 5 | Scheduler ready | `[AegisOS] scheduler ready` | ✅ |
| 6 | Capabilities assigned | `[AegisOS] capabilities assigned` | ✅ |
| 7 | Bootstrap into EL0 | `[AegisOS] bootstrapping into task_a` | ✅ |
| 8 | Task A PING | `A:PING` | ✅ |
| 9 | Task B PONG | `B:PONG` | ✅ |

### QEMU Output (trích)

```
[AegisOS] boot
[AegisOS] MMU enabled (identity map)
[AegisOS] W^X enforced (WXN + 4KB pages)
[AegisOS] exceptions ready
[AegisOS] scheduler ready (3 tasks, EL0)
[AegisOS] capabilities assigned
[AegisOS] timer started (10ms, freq=62MHz)
[AegisOS] bootstrapping into task_a (EL0)...
A:PING B:PONG A:PING B:PONG A:PING B:PONG ...
```

> Không có dòng `!!! CAP DENIED` nào — tất cả syscall đều được cấp phép đúng theo capability bitmask.

---

## 3. Tổng kết

| Loại test | Pass | Fail | Tổng |
|---|---|---|---|
| Host Unit Tests | 69 | 0 | 69 |
| QEMU Boot Checkpoints | 9 | 0 | 9 |
| **Tổng** | **78** | **0** | **78** |

### Trạng thái: ✅ ALL PASS

> Tất cả kiểm thử đều đạt. Phase G (Capability-Based Access Control) đã được tích hợp thành công.
> Kernel sẵn sàng cho phase tiếp theo.
